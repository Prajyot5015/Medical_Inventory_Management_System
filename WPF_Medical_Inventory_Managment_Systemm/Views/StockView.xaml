<Page x:Class="WPF_Medical_Inventory_Managment_Systemm.Views.StockView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="clr-namespace:WPF_Medical_Inventory_Managment_Systemm.Views"
      Title="Stock Management"
      Height="Auto"
      Width="Auto">

    <Page.Resources>
        <!-- Button Style with Hover Animation -->
        <Style x:Key="StockButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#1976D2"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Trigger.EnterActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="(Button.RenderTransform).(ScaleTransform.ScaleX)"
                                                 To="1.05" Duration="0:0:0.15"/>
                                <DoubleAnimation Storyboard.TargetProperty="(Button.RenderTransform).(ScaleTransform.ScaleY)"
                                                 To="1.05" Duration="0:0:0.15"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.EnterActions>
                    <Trigger.ExitActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="(Button.RenderTransform).(ScaleTransform.ScaleX)"
                                                 To="1" Duration="0:0:0.15"/>
                                <DoubleAnimation Storyboard.TargetProperty="(Button.RenderTransform).(ScaleTransform.ScaleY)"
                                                 To="1" Duration="0:0:0.15"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.ExitActions>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Drop shadow effect -->
        <DropShadowEffect x:Key="DropShadowEffect"
                          Color="Black"
                          Direction="270"
                          ShadowDepth="4"
                          Opacity="0.2"
                          BlurRadius="10"/>

        <!-- Fade-in animation storyboard -->
        <Storyboard x:Key="FadeInStoryboard">
            <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.4"/>
        </Storyboard>
    </Page.Resources>

    <Grid Background="#FAFAFA">
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <TabControl Grid.Row="0"
                    x:Name="MainTabControl"
                    Margin="20"
                    FontSize="15"
                    FontWeight="SemiBold"
                    SelectedIndex="{Binding SelectedTabIndex, Mode=TwoWay}"
                    SelectionChanged="MainTabControl_SelectionChanged"
                    Background="White"
                    BorderThickness="1"
                    BorderBrush="#E0E0E0">

            <!-- All Stock Tab -->
            <TabItem Header="All Stock" HorizontalAlignment="Left" Margin="-2,-2,0,0" Width="75">
                <Grid Background="White" Opacity="0" Loaded="Tab_Loaded">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="7*"/>
                        <ColumnDefinition Width="47*"/>
                        <ColumnDefinition Width="83*"/>
                        <ColumnDefinition Width="189*"/>
                    </Grid.ColumnDefinitions>
                    <DataGrid x:Name="StockDataGrid"
                              AutoGenerateColumns="False"
                              ItemsSource="{Binding StockList}"
                              IsReadOnly="True"
                              CanUserAddRows="False"
                              GridLinesVisibility="Horizontal"
                              AlternatingRowBackground="#F5F5F5"
                              RowBackground="White"
                              ColumnHeaderHeight="40"
                              RowHeight="35"
                              FontSize="13"
                              BorderBrush="#E0E0E0"
                              BorderThickness="1" Grid.ColumnSpan="4">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Stock ID" Binding="{Binding Id}" Width="*" />
                            <DataGridTextColumn Header="Product Name" Binding="{Binding ProductName}" Width="2*" />
                            <DataGridTextColumn Header="Product ID" Binding="{Binding ProductId}" Width="*" />
                            <DataGridTextColumn Header="Batch" Binding="{Binding Batch}" Width="*" />
                            <DataGridTextColumn Header="Brand" Binding="{Binding BrandName}" Width="*" />
                            <DataGridTextColumn Header="Current Stock" Binding="{Binding CurrentStock}" Width="*" />
                            <DataGridTextColumn Header="Low Stock Threshold" Binding="{Binding LowStockThreshold}" Width="*" />
                            <DataGridTextColumn Header="Expiry Date" Binding="{Binding ExpiryDate, StringFormat=d}" Width="*" />
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- Low Stock Tab -->
            <TabItem Header="Low Stock">
                <Grid Background="White" Opacity="0" Loaded="Tab_Loaded">
                    <DataGrid x:Name="LowStockDataGrid"
                              AutoGenerateColumns="False"
                              ItemsSource="{Binding LowStockList}"
                              SelectedItem="{Binding SelectedStockItem, Mode=TwoWay}"
                              IsReadOnly="True"
                              CanUserAddRows="False"
                              AlternatingRowBackground="#F5F5F5"
                              RowBackground="White"
                              ColumnHeaderHeight="40"
                              RowHeight="35"
                              FontSize="13"
                              BorderBrush="#E0E0E0"
                              BorderThickness="1"
                              SelectionChanged="LowStockDataGrid_SelectionChanged">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Stock ID" Binding="{Binding Id}" Width="*" />
                            <DataGridTextColumn Header="Product Name" Binding="{Binding ProductName}" Width="*" />
                            <DataGridTextColumn Header="Product ID" Binding="{Binding ProductId}" Width="*" />
                            <DataGridTextColumn Header="Batch" Binding="{Binding Batch}" Width="*" />
                            <DataGridTextColumn Header="Brand" Binding="{Binding BrandName}" Width="*" />
                            <DataGridTextColumn Header="Current Stock" Binding="{Binding CurrentStock}" Width="*" />
                            <DataGridTextColumn Header="Low Stock Threshold" Binding="{Binding LowStockThreshold}" Width="*" />
                            <DataGridTemplateColumn Header="Actions" Width="Auto">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="Add Stock"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Background="LightGreen"
                                                Margin="0,0,0,0"
                                                Style="{StaticResource StockButtonStyle}"
                                                Command="{Binding DataContext.NavigateToAddStockCommand, RelativeSource={RelativeSource AncestorType=TabControl}}"
                                                CommandParameter="{Binding}" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- Near Expiry Tab -->
            <TabItem Header="Near Expiry">
                <Grid Background="White" Opacity="0" Loaded="Tab_Loaded">
                    <DataGrid x:Name="NearExpiryDataGrid"
                              AutoGenerateColumns="False"
                              ItemsSource="{Binding NearExpiryStockList}"
                              SelectedItem="{Binding SelectedStockItem, Mode=TwoWay}"
                              IsReadOnly="True"
                              CanUserAddRows="False"
                              AlternatingRowBackground="#F5F5F5"
                              RowBackground="White"
                              ColumnHeaderHeight="40"
                              RowHeight="35"
                              FontSize="13"
                              BorderBrush="#E0E0E0"
                              BorderThickness="1"
                              SelectionChanged="NearExpiryDataGrid_SelectionChanged_1">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Stock ID" Binding="{Binding Id}" Width="*" />
                            <DataGridTextColumn Header="Product Name" Binding="{Binding ProductName}" Width="2*" />
                            <DataGridTextColumn Header="Product ID" Binding="{Binding ProductId}" Width="*" />
                            <DataGridTextColumn Header="Batch" Binding="{Binding Batch}" Width="*" />
                            <DataGridTextColumn Header="Brand" Binding="{Binding BrandName}" Width="*" />
                            <DataGridTextColumn Header="Expiry Date" Binding="{Binding ExpiryDate, StringFormat=d}" Width="*" />
                            <DataGridTextColumn Header="Current Stock" Binding="{Binding CurrentStock}" Width="*" />
                            <DataGridTemplateColumn Header="Actions">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="Add Stock"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Background="LightGreen"
                                                Margin="0,0,0,0"                                                
                                                Style="{StaticResource StockButtonStyle}"
                                                Command="{Binding DataContext.NavigateToAddStockCommand, RelativeSource={RelativeSource AncestorType=TabControl}}"
                                                CommandParameter="{Binding}" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- Add Stock Tab -->
            <TabItem Header="Add Stock">
                <Grid Background="#FAFAFA" Opacity="0" Loaded="Tab_Loaded">
                    <Border Width="500"
                            Padding="24"
                            Background="White"
                            BorderBrush="#CFD8DC"
                            BorderThickness="1"
                            CornerRadius="12"
                            Effect="{StaticResource DropShadowEffect}"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            RenderTransformOrigin="0.5,0.5">
                        <Border.RenderTransform>
                            <ScaleTransform ScaleX="0.95" ScaleY="0.95"/>
                        </Border.RenderTransform>
                        <Border.Triggers>
                            <EventTrigger RoutedEvent="Border.Loaded">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.4"/>
                                        <DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(ScaleTransform.ScaleX)" To="1" Duration="0:0:0.3"/>
                                        <DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(ScaleTransform.ScaleY)" To="1" Duration="0:0:0.3"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                        </Border.Triggers>

                        <StackPanel>
                            <TextBlock Text="Add Product To The Stock" FontSize="22" FontWeight="Bold" Foreground="#212121" Margin="0 0 0 20" HorizontalAlignment="Center"/>
                            <TextBlock Text="Select Product:" FontWeight="SemiBold" Margin="0 6 0 2"/>
                            <ComboBox ItemsSource="{Binding Products}" DisplayMemberPath="Id" SelectedValuePath="Id" SelectedValue="{Binding SelectedProductId, Mode=TwoWay}" Padding="6" Background="White" Margin="0 0 0 12"/>
                            <TextBlock Text="Product Name:" FontWeight="SemiBold" Margin="0 6 0 2"/>
                            <ComboBox ItemsSource="{Binding Products}" DisplayMemberPath="Name" SelectedValuePath="Id" SelectedValue="{Binding SelectedProductId, Mode=TwoWay}" Margin="0,0,0,10" Padding="6" IsReadOnly="True" IsHitTestVisible="False" Background="#F5F5F5" Foreground="Gray"/>
                            <TextBlock Text="Quantity to Add:" FontWeight="SemiBold" Margin="0 6 0 2"/>
                            <TextBox Text="{Binding QuantityToAdd, UpdateSourceTrigger=PropertyChanged}" Padding="6" Background="White" Margin="0 0 0 20"/>
                            <Button Content="Add Stock" Width="140" Style="{StaticResource StockButtonStyle}" Command="{Binding AddStockCommand}" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </TabItem>
        </TabControl>

        <ScrollViewer Grid.Row="1" Margin="10,0,10,10" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center"/>
        </ScrollViewer>
    </Grid>
</Page>
